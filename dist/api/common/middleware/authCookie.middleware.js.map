{"version":3,"file":"authCookie.middleware.js","sourceRoot":"","sources":["../../../../src/api/common/middleware/authCookie.middleware.ts"],"names":[],"mappings":";;;;;;AACA,kFAAyD;AACzD,yDAAqD;AAErD,4BAA4B;AACrB,MAAM,wBAAwB,GAAG,CAAC,eAAwB,IAAI,EAAE,EAAE;IACvE,OAAO,CAAC,GAAY,EAAE,GAAa,EAAE,IAAkB,EAAE,EAAE;QACzD,IAAI,CAAC;YACH,MAAM,KAAK,GAAG,GAAG,CAAC,OAAO,CAAC,WAAW,CAAC;YAEtC,MAAM,UAAU,GAAG,KAAK,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;YAE7C,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;YAEjB,IAAI,CAAC,KAAK,EAAE,CAAC;gBACX,GAAG,CAAC,KAAK,GAAG;oBACV,EAAE,EAAE,EAAE;oBACN,IAAI,EAAE,UAAU;iBACjB,CAAC;gBAEF,IAAI,YAAY,EAAE,CAAC;oBACjB,MAAM,IAAI,wBAAa,CAAC,GAAG,EAAE,OAAO,CAAC,CAAC;gBACxC,CAAC;gBAED,IAAI,EAAE,CAAC;gBACP,OAAO;YACT,CAAC;YAED,MAAM,OAAO,GAAG,wBAAU,CAAC,iBAAiB,CAAC,UAAU,CAAC,CAAC;YAEzD,GAAG,CAAC,KAAK,GAAG;gBACV,EAAE,EAAE,OAAO,CAAC,EAAE;gBACd,IAAI,EAAE,OAAO,CAAC,IAAI;aACnB,CAAC;YAEF,IAAI,EAAE,CAAC;QACT,CAAC;QAAC,OAAO,KAAU,EAAE,CAAC;YACpB,0DAA0D;YAC1D,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,QAAQ,CAAC,wBAAwB,GAAG,CAAC,WAAW,IAAI,EAAE,EAAE,CAAC,CAAC;QAC5E,CAAC;IACH,CAAC,CAAC;AACJ,CAAC,CAAC;AApCW,QAAA,wBAAwB,4BAoCnC","sourcesContent":["import { Request, Response, NextFunction } from \"express\";\r\nimport HttpException from \"../exceptions/http.exception\";\r\nimport { JwtService } from \"../services/jwt.service\";\r\n\r\n/** 쿠키속 토큰으로 인증하는 인증 미들웨어 */\r\nexport const authCookieViewMiddleware = (authRedirect: boolean = true) => {\r\n  return (req: Request, res: Response, next: NextFunction) => {\r\n    try {\r\n      const token = req.cookies.accessToken;\r\n\r\n      const tokenValue = token.split(\"Bearer \")[1];\r\n\r\n      console.log(req);\r\n\r\n      if (!token) {\r\n        req.admin = {\r\n          id: \"\",\r\n          role: \"hospital\",\r\n        };\r\n\r\n        if (authRedirect) {\r\n          throw new HttpException(401, \"인증 실패\");\r\n        }\r\n\r\n        next();\r\n        return;\r\n      }\r\n\r\n      const payload = JwtService.verifyAccessToken(tokenValue);\r\n\r\n      req.admin = {\r\n        id: payload.id,\r\n        role: payload.role,\r\n      };\r\n\r\n      next();\r\n    } catch (error: any) {\r\n      // next(new HttpException(401, `인증 실패 ${error.message}`));\r\n      res.status(302).redirect(`/auth/login?redirect=${req.originalUrl || \"\"}`);\r\n    }\r\n  };\r\n};\r\n"]}